"use strict";(self.webpackChunkatashop=self.webpackChunkatashop||[]).push([[592],{6588:(k,p,i)=>{i.d(p,{e:()=>U});class f{constructor(){}static isTokenExpired(r,e){if(!r||""===r)return!0;const t=this._getTokenExpirationDate(r);return e=e||0,null===t||!(t.valueOf()>(new Date).valueOf()+1e3*e)}static _b64decode(r){let t="";if((r=String(r).replace(/=+$/,"")).length%4==1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(let h,n,o=0,b=0;n=r.charAt(b++);~n&&(h=o%4?64*h+n:n,o++%4)?t+=String.fromCharCode(255&h>>(-2*o&6)):0)n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(n);return t}static _b64DecodeUnicode(r){return decodeURIComponent(Array.prototype.map.call(this._b64decode(r),e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))}static _urlBase64Decode(r){let e=r.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw Error("Illegal base64url string!")}return this._b64DecodeUnicode(e)}static _decodeToken(r){if(!r)return null;const e=r.split(".");if(3!==e.length)throw new Error("The inspected token doesn't appear to be a JWT. Check to make sure it has three parts and see https://jwt.io for more.");const t=this._urlBase64Decode(e[1]);if(!t)throw new Error("Cannot decode the token.");return JSON.parse(t)}static _getTokenExpirationDate(r){const e=this._decodeToken(r);if(!e.hasOwnProperty("exp"))return null;const t=new Date(0);return t.setUTCSeconds(e.exp),t}}var u=i(553),l=i(4664),a=i(2096),c=i(5879),d=i(9862);let g=(()=>{class s{constructor(e){this._httpClient=e,this.sidebar=!0,this.baseURL=`${u.N.apiUrl}/userBasics`,this._authenticated=!1}fetchAll(){return this._httpClient.get(`${this.baseURL}/`)}fetch(e){return this._httpClient.get(`${this.baseURL}/${e}`)}create(e){return this._httpClient.post(`${this.baseURL}/`,e)}delete(e){return this._httpClient.delete(`${this.baseURL}/${e}`)}update(e,t){return this._httpClient.put(`${this.baseURL}/${e}`,t)}generateReceipt(e){return this._httpClient.get(`${this.baseURL}/${e}/receipt`,{responseType:"blob"})}sendCredentialsMail(e){return this._httpClient.get(`${this.baseURL}/send-email/${e}`)}setUserData(e){localStorage.setItem("currentUser",JSON.stringify(e))}getUserData(){let e=localStorage.getItem("currentUser");return e?(e=JSON.parse(e),{name:e.name,role:e.role}):{name:"",role:""}}clearUserData(){localStorage.removeItem("currentUser")}static#e=this.\u0275fac=function(t){return new(t||s)(c.LFG(d.eN))};static#t=this.\u0275prov=c.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})(),U=(()=>{class s{constructor(e,t){this._httpClient=e,this._userBasicService=t,this.baseURL=`${u.N.apiUrl}/userBasics`,this._authenticated=!1}signIn(e){return this._httpClient.post(`${this.baseURL}/login`,e).pipe((0,l.w)(t=>(t.error||(this.accessToken=t.data.accessToken,this._authenticated=!0,this._userBasicService.setUserData(t.data)),(0,a.of)(t))))}create(e){return this._httpClient.post(`${this.baseURL}/`,e).pipe((0,l.w)(t=>(t.error||(this.accessToken=t.user.accessToken,this._authenticated=!0,this._userBasicService.setUserData(t.user)),(0,a.of)(t))))}signOut(){return localStorage.removeItem("accessToken"),this._userBasicService.clearUserData(),this._authenticated=!1,(0,a.of)(!0)}get accessToken(){return localStorage.getItem("accessToken")??""}set accessToken(e){localStorage.setItem("accessToken",e)}check(){return this._authenticated?(0,a.of)(!0):f.isTokenExpired(this.accessToken)||!this.accessToken?(0,a.of)(!1):(0,a.of)(!0)}getRole(){return this._userBasicService.getUserData().role}static#e=this.\u0275fac=function(t){return new(t||s)(c.LFG(d.eN),c.LFG(g))};static#t=this.\u0275prov=c.Yz7({token:s,factory:s.\u0275fac})}return s})()}}]);